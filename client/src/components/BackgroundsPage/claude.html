<!DOCTYPE html>
<html>
<head>
  <style>
    #container {
      position: relative;
      width: 300px;
      height: 300px;
      border: 2px solid black;
      overflow: hidden;
      margin: 20px auto;
    }
    .ball {
      position: absolute;
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background-color: red;
    }
    #counter {
      position: absolute;
      top: 10px;
      left: 10px;
      font-family: Arial, sans-serif;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="counter">Balls: 1</div>
  </div>

  <script>
    const container = document.getElementById('container');
    const counter = document.getElementById('counter');
    const containerWidth = container.offsetWidth;
    const containerHeight = container.offsetHeight;
    const ballSize = 15;
    const ballRadius = ballSize / 2;
    
    let balls = [];
    let ballCount = 0;
    
    function createBall(x, y, vx, vy) {
      const ball = document.createElement('div');
      ball.className = 'ball';
      
      // Random color
      const colors = ['#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6', '#1abc9c'];
      ball.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
      
      container.appendChild(ball);
      
      balls.push({
        element: ball,
        x: x || containerWidth / 2,
        y: y || containerHeight / 2,
        vx: vx || (Math.random() * 4 - 2),
        vy: vy || (Math.random() * 4 - 2)
      });
      
      ballCount++;
      counter.textContent = `Balls: ${ballCount}`;
    }
    
    function resetAnimation() {
      // Clear all balls
      balls.forEach(ball => {
        container.removeChild(ball.element);
      });
      balls = [];
      ballCount = 0;
      
      // Create a new ball
      createBall();
    }
    
    function updateBalls() {
      let collisions = [];
      
      balls.forEach((ball, index) => {
        // Update position
        ball.x += ball.vx;
        ball.y += ball.vy;
        
        // Check boundaries
        let collision = false;
        
        if (ball.x <= ballRadius) {
          ball.vx = Math.abs(ball.vx);
          ball.x = ballRadius;
          collision = 'left';
        } else if (ball.x >= containerWidth - ballRadius) {
          ball.vx = -Math.abs(ball.vx);
          ball.x = containerWidth - ballRadius;
          collision = 'right';
        }
        
        if (ball.y <= ballRadius) {
          ball.vy = Math.abs(ball.vy);
          ball.y = ballRadius;
          collision = 'top';
        } else if (ball.y >= containerHeight - ballRadius) {
          ball.vy = -Math.abs(ball.vy);
          ball.y = containerHeight - ballRadius;
          collision = 'bottom';
        }
        
        // Update DOM element
        ball.element.style.left = `${ball.x - ballRadius}px`;
        ball.element.style.top = `${ball.y - ballRadius}px`;
        
        // Record collision
        if (collision && ballCount < 30) {
          collisions.push({
            index,
            collision,
            ball
          });
        }
      });
      
      // Handle one collision per frame to prevent explosive growth
      if (collisions.length > 0 && ballCount < 30) {
        const collision = collisions[0];
        const ball = balls[collision.index];
        
        // Create a new ball with slightly different direction
        const angle = Math.random() * Math.PI / 4 - Math.PI / 8;
        const speed = Math.sqrt(ball.vx * ball.vx + ball.vy * ball.vy);
        
        let newVx, newVy;
        
        if (collision.collision === 'left' || collision.collision === 'right') {
          newVx = -ball.vx * Math.cos(angle);
          newVy = ball.vy + speed * Math.sin(angle);
        } else {
          newVx = ball.vx + speed * Math.sin(angle);
          newVy = -ball.vy * Math.cos(angle);
        }
        
        createBall(ball.x, ball.y, newVx, newVy);
      }
      
      // Reset if we've reached 30 balls
      if (ballCount >= 30) {
        setTimeout(resetAnimation, 2000);
      }
      
      requestAnimationFrame(updateBalls);
    }
      
    // Start with one ball
    createBall();
    updateBalls();
  </script>
</body>
</html>